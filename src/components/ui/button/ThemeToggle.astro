---
---

<button type="button" class="sw-btn-sm no-underline flex items-center gap-1" aria-label="Toggle theme" aria-pressed="false" data-theme-toggle>
  <span class="sr-only">Toggle theme</span>
  <span class="theme-icon" aria-hidden="true">
    <svg class="icon-sun" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
    <svg class="icon-moon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
  </span>
  <span class="label">Theme</span>
</button>

<script is:inline>
  const storageKey = 'theme';
  const root = document.documentElement;

  function applyTheme() {
    const t = localStorage.getItem(storageKey) === 'dark' ? 'dark' : 'light';
    root.dataset.theme = t;
    root.classList.toggle('dark', t === 'dark');
  }

  // 1) Aplica tema antes de pintar la nueva página (evita “flash”)
  document.addEventListener('astro:after-swap', applyTheme);

  // 2) (Re)conecta el click del botón en cada navegación
  document.addEventListener('astro:page-load', () => {
    const btn = document.querySelector('[data-theme-toggle]');
    if (!btn) return;
    // sincroniza aria-pressed con el estado actual
    btn.setAttribute('aria-pressed', String(root.classList.contains('dark')));
    btn.onclick = () => {
      const next = root.classList.contains('dark') ? 'light' : 'dark';
      localStorage.setItem(storageKey, next);
      applyTheme();
      btn.setAttribute('aria-pressed', String(next === 'dark'));
    };
  });

  // Primera carga
  applyTheme();
</script>


<style is:inline>
  [data-theme-toggle] .icon-moon { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-sun { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-moon { display: inline; }
</style>


